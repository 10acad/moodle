define(["jquery","core/ajax","block_xp/throttler","block_xp/resource-selector"],function(a,b,c,d){function e(a,b){d.prototype.constructor.apply(this,[a,this.filterFunction.bind(this),b]),this.resources=[],this.courseId=null,this.throttler=new c(100),this.setMinChars(0)}return e.prototype=Object.create(d.prototype),e.prototype.constructor=e,e.prototype.initForCourse=function(a){return this.courseId==a?void this.displayResults(this.resources):(this.displaySearching(),this.courseId=a,void this.fetchAllForCourse(a).then(function(b){this.courseId==a&&(this.resources=b,this.displayResults(this.resources))}.bind(this)).fail(function(){this.resources=[],this.displayEmptyResults()}))},e.prototype.fetchAllForCourse=function(a){var c={courseid:a,query:"*"},d=[{methodname:"block_xp_search_modules",args:c}];return b.call(d)[0].then(function(a){return a.reduce(function(a,b){return a.concat(b.modules.map(function(a){return{_iscm:!0,subname:b.name,name:a.name,cm:a}}))},[])})},e.prototype.filterFunction=function(a){return a=(a||"").toLowerCase(),a?this.resources.filter(function(b){return b.name.toLowerCase().indexOf(a)>-1}):this.resources},e});